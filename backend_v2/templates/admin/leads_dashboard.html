{% extends "admin_base.html" %}

{% block title %}Leads · THE13TH Admin{% endblock %}
{% block breadcrumb_prefix %}Admin · Operations{% endblock %}
{% block breadcrumb_title %}Leads Dashboard{% endblock %}

{% block content %}
<div class="space-y-6">

  <!-- Filters + Summary -->
  <div
    class="rounded-3xl border border-purple-600/40 bg-[#120017]/70 backdrop-blur-lg px-5 py-4 sm:px-6 sm:py-5 shadow-xl">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
      <div>
        <p class="text-[11px] uppercase tracking-[0.16em] text-purple-200/80 font-semibold">
          Live Leads Dashboard
        </p>
        <p class="text-sm text-purple-100/85">
          {{ leads|length }} leads loaded
          {% if status %}
            · filtered by status <span class="font-semibold">{{ status }}</span>
          {% endif %}
          {% if search %}
            · search: <span class="font-semibold">{{ search }}</span>
          {% endif %}
        </p>
      </div>

      <form method="get" class="flex flex-wrap items-center gap-2 sm:gap-3 text-[13px]">
        <input
          type="text"
          name="search"
          value="{{ search or '' }}"
          placeholder="Search name, email, source…"
          class="px-3 py-1.5 rounded-full bg-black/30 border border-purple-500/60 text-sm text-purple-50 placeholder:text-purple-300/60 focus:outline-none focus:ring-1 focus:ring-pink-400"
        />
        <select
          name="status"
          class="px-3 py-1.5 rounded-full bg-black/30 border border-purple-500/60 text-sm text-purple-50 focus:outline-none focus:ring-1 focus:ring-pink-400">
          <option value="">All statuses</option>
          <option value="new" {% if status == 'new' %}selected{% endif %}>New</option>
          <option value="in_progress" {% if status == 'in_progress' %}selected{% endif %}>In progress</option>
          <option value="closed" {% if status == 'closed' %}selected{% endif %}>Closed</option>
          <option value="lost" {% if status == 'lost' %}selected{% endif %}>Lost</option>
        </select>
        <button
          type="submit"
          class="inline-flex items-center gap-1 rounded-full bg-gradient-to-r from-purple-500 to-fuchsia-500 px-4 py-1.5 text-[12px] font-semibold text-white shadow-md shadow-purple-900/60 hover:brightness-110 transition">
          Apply
        </button>
      </form>
    </div>
  </div>

  <!-- Table -->
  <div
    class="rounded-3xl border border-purple-600/40 bg-[#120017]/80 backdrop-blur-lg shadow-xl overflow-hidden">
    <div class="overflow-x-auto">
      <table class="min-w-full text-left text-sm text-purple-100/90">
        <thead class="bg-purple-900/60 border-b border-purple-700/60 text-[11px] uppercase tracking-[0.16em] text-purple-200/80">
          <tr>
            <th class="px-4 py-3">Lead</th>
            <th class="px-4 py-3">Contact</th>
            <th class="px-4 py-3 hidden md:table-cell">Source</th>
            <th class="px-4 py-3 hidden lg:table-cell">Brokerage</th>
            <th class="px-4 py-3">Status</th>
            <th class="px-4 py-3 hidden md:table-cell">Created</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-purple-900/70">
        {% if leads %}
          {% for lead in leads %}
          <tr class="hover:bg-purple-900/30 transition">
            <!-- Lead -->
            <td class="px-4 py-3 align-top">
              <div class="flex flex-col gap-0.5">
                <span class="font-semibold text-purple-50">
                  {{ lead.display_name or lead.full_name or lead.name or ('Lead #' ~ lead.id) }}
                </span>
                {% if lead.id %}
                <span class="text-[11px] text-purple-300/80">
                  ID: {{ lead.id }}
                </span>
                {% endif %}
              </div>
            </td>

            <!-- Contact -->
            <td class="px-4 py-3 align-top">
              <div class="flex flex-col gap-0.5 text-[13px]">
                {% if lead.email %}
                <span class="text-purple-100/90">{{ lead.email }}</span>
                {% endif %}
                {% if lead.phone %}
                <span class="text-purple-300/90 text-xs">{{ lead.phone }}</span>
                {% endif %}
              </div>
            </td>

            <!-- Source -->
            <td class="px-4 py-3 align-top hidden md:table-cell">
              <span class="inline-flex items-center gap-1 rounded-full border border-indigo-400/60 bg-indigo-900/40 px-3 py-0.5 text-[11px] text-purple-100">
                {{ lead.source or 'Unknown' }}
              </span>
            </td>

            <!-- Brokerage -->
            <td class="px-4 py-3 align-top hidden lg:table-cell">
              <div class="flex flex-col gap-0.5 text-[13px]">
                {% if lead.tenant_name %}
                  <span class="text-purple-100/90">{{ lead.tenant_name }}</span>
                {% elif lead.tenant_key %}
                  <span class="text-purple-100/90">{{ lead.tenant_key }}</span>
                {% else %}
                  <span class="text-purple-300/70">Unassigned</span>
                {% endif %}
              </div>
            </td>

            <!-- Status -->
            <td class="px-4 py-3 align-top">
              {% set s = (lead.status or 'unknown') | lower %}
              {% if s in ['new', 'open'] %}
                {% set badge_bg = 'bg-emerald-500/15 border-emerald-400/70 text-emerald-200' %}
                {% set label = 'New' %}
              {% elif s in ['in_progress', 'working'] %}
                {% set badge_bg = 'bg-amber-500/15 border-amber-400/70 text-amber-200' %}
                {% set label = 'In progress' %}
              {% elif s in ['closed', 'won'] %}
                {% set badge_bg = 'bg-sky-500/15 border-sky-400/70 text-sky-200' %}
                {% set label = 'Closed' %}
              {% elif s in ['lost'] %}
                {% set badge_bg = 'bg-rose-500/15 border-rose-400/70 text-rose-200' %}
                {% set label = 'Lost' %}
              {% else %}
                {% set badge_bg = 'bg-purple-500/15 border-purple-400/70 text-purple-100' %}
                {% set label = lead.status or 'Unknown' %}
              {% endif %}

              <span class="inline-flex items-center rounded-full border px-3 py-0.5 text-[11px] {{ badge_bg }}">
                {{ label }}
              </span>
            </td>

            <!-- Created -->
            <td class="px-4 py-3 align-top hidden md:table-cell">
              <div class="flex flex-col gap-0.5 text-[11px] text-purple-200/85">
                {% if lead.created_at %}
                  <span>{{ lead.created_at }}</span>
                {% endif %}
                {% if lead.first_response_minutes is not none %}
                  <span class="text-[10px] text-purple-300/80">
                    First response: {{ lead.first_response_minutes }} min
                  </span>
                {% endif %}
              </div>
            </td>
          </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="6" class="px-4 py-6 text-center text-sm text-purple-200/80">
              No leads found for this filter. Try clearing the status or search query.
            </td>
          </tr>
        {% endif %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
